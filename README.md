# example-tgbot

Ranepa telegram bot for education (computer science)

## 1. Установка

Для запуска проекта стяните его с помощью `git clone`

## 2. Перед запуском

1. Полученный токен в [BotFather](https://t.me/BotFather) вставить в созданный файл `.env`

```
TOKEN=<ВАШ ТОКЕН>
```

С помощью команды `echo`.

```
echo "TOKEN=<ВАШ ТОКЕН>" > .env
```

2. Для записи лога создайте папку `logs`. Вот команда в терминале:

```
mkdir logs
```

3. Перед запуском тестов настройте изолированную среду, как в разделе 3. Вот команда для запуска тестов.

```
python3 -m pytest tests/
```

## 3. Запуск проекта в изолированной среде

Перейдите в каталог проекта и создайте изолированную среду. Например, `.venv`

```
python3 -m venv .venv
```

Запустите среду и установите зависимости
   
```
pip install -r requirements.txt
```

Для запуска проекта введите в консоли

```
python3 main.py
```
## 4. Запуск docker-контейнера

Для запуска проекта в контейнере стяните его с помощью `git clone`. Проект содержит `Dockerfile` и `docker-compose.yml`

Перейдите в каталог проекта и запустите команду сборки контейнера `example-tgbot:vX`, где X – текущая версия проекта.

```
docker build -t <ВАШ КОНТЕЙНЕР>:v<ВЕРСИЯ> .
```
Для запуска контейнера в фоновом режиме используйте команду

```
docker run -d -e .env <ВАШ КОНТЕЙНЕР>:v<ВЕРСИЯ>
```

Проверить состоятние запущенного контейнера для `docker`

```
docker ps
```

Для автоматизированной сборки нескольких контейнеров воспользуйтесь `docker-compose`. При запуске на удаленном сервере `docker-compose` будет перезапускать контейнеры автоматически!

```
docker-compose up --build -d
```

Проверить состоятние запущенного контейнера для `docker-compose`

```
docker-compose ps
```

Если вы хотите остановить контейнер `docker`

```
docker stop <ID-контейнера>
```

Для удаления контейнера

```
docker rm <ID-контейнера>
```

Если вы хотите остановить `docker-compose`

```
docker-compose down
```

Перезапустить контейнеры

```
docker-compose restart
```

## Материал

* Дополнительный гайд по aiogram https://mastergroosha.github.io/aiogram-3-guide/quickstart/
* Дополнительный гайд по асинхронному бэкенду https://habr.com/ru/companies/kts/articles/598575/
* Для создания бота необходимо получить token в telegram https://t.me/BotFather
* Бот принимает команды, например /start. Создадим хендлер - обработчик сообщений, и будем возвращать сообщение, указанное в функции подробнее о конструкции async/await - https://docs-python.ru/tutorial/sintaksis-async-await-python/
* Запуск процесса поллинга новых апдейтов. Существует 2 способа получить уведомления:
  * `webhook` — инициатором запроса выступает Телеграм. Когда пользователь пишет боту, Телеграм делает запрос на URL, который вы установите с помощью метода setwebhook.
  * `long polling` — инициатором является ваше приложение. Оно обращается к Telegram API и получает уведомления или ожидает, если уведомлений нет.
* pyhton-dotenv для настройки переменных окружения https://pypi.org/project/python-dotenv/
* Дополнительный материал про создание Docker-контейнера и запуск бота https://habr.com/ru/articles/823714/
* Callback_query_handler - это функция, которая позволяет обрабатывать коллбек-запросы от пользователей. Коллбэк-запрос - это запрос, который отправляется боту, когда пользователь нажимает кнопку в его чате.
* Всегда полезно знать что происходило с программой в процессе ее выполнения. Это осуществляется с помощью стандартной библиотеки логирования logging. Подробнее о логировании вы сможете узнать по ссылке https://github.com/pyshkovni/python_logs
  * Существует 5 уровней логирования:
    * DEBUG – Детальная информация, интересная только при отладке; 
    * INFO – Подтверждение, что все работает как надо; 
    * WARNING – Индикация того, что что-то пошло не так, и возможны проблемы в будущем (заканчивается место на диске, етс), но программа продолжает работать как надо. Уровень WARNING стоит по умолчанию 
    * ERROR – Относительно серьезная проблема, программа не смогла выполнить некоторый функционал. 
    * CRITICAL – Очень серьезная проблема, программа не может работать дальше.
* Дополнительный материал по тестированию телеграм-бота https://habr.com/ru/companies/beeline_cloud/articles/734164/
* Материал по основам тестирования в Python (репозиторий) https://github.com/pyshkovni/python_tests
